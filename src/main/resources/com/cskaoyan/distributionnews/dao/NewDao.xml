<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cskaoyan.distributionnews.dao.NewDao">
    <sql id="table">news</sql>

    <resultMap id="newMap" type="new">
        <id column="id" property="id"/>
        <result column="title" property="title"/>
        <result column="link" property="link"/>
        <result column="image" property="image"/>
        <result column="like_count" property="likeCount"/>
        <result column="comment_count" property="commentCount"/>
        <result column="created_date" property="createdDate"/>
        <association property="user" column="user_id" javaType="user"
                     select="com.cskaoyan.distributionnews.dao.UserDao.selectUserById"/>
    </resultMap>
    <select id="selectAllNew" resultMap="newMap">
      select
      id,title, link, image, like_count, comment_count,created_date,user_id
      from <include refid="table"/>
    </select>

    <select id="selectNewById" resultMap="newMap">
        select
        id,title, link, image, like_count, comment_count,created_date,user_id
        from <include refid="table"/>
        where id =#{id}
    </select>

    <select id="selectNewsByUserId" resultMap="newMap">
        select
        id,title, link, image, like_count, comment_count,created_date,user_id
        from <include refid="table"/>
        where user_id =#{userId}
    </select>


    <select id="selectLikeCountById" resultType="_int">
        select
        like_count
        from <include refid="table"/>
        where id =#{id}
    </select>


    <insert id="insertNews" >
        insert into
        <include refid="table"/>
        (id,title, link, image,created_date,user_id)
        value(#{id},#{title},#{link},#{image},now(),#{user.id})
    </insert>

    <update id="updateCommentCountById">
        update
        <include refid="table"/>
        set comment_count = comment_count + 1
        where id=#{id}
    </update>

    <update id="increaseLikeCountById">
        update
        <include refid="table"/>
        set like_count = like_count + 1
        where id=#{id}
    </update>

    <update id="decreaseLikeCountById">
        update
        <include refid="table"/>
        set like_count = like_count - 1
        where id=#{id}
    </update>
</mapper>
